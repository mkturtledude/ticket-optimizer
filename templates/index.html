{% extends 'base.html' %}

{% block head %}
{% endblock %}

{% block body %}
      <h1>Ticket Optimizer</h1>
      <h2>Updated for the Anniversary Tour</h2>
<!--h3>It will gradually start working as the action counts get added to the DKR sheet, but use at your own risk</h3-->
      <!--h4 style="color: red;">Attention: The cup boosts for future tours aren't working properly, I'll fix that in the next 24 hours</h4-->


  <a href="/faq">Help/FAQ</a><br>
  <a href="https://www.youtube.com/watch?v=udHHcQWkhqc">Basic Video Tutorial</a>

    <form action="/results" method="POST" enctype="multipart/form-data">
        <fieldset class="bg-light p-2">
            <legend>Inventory</legend>
            <p>Upload  as CSV:</p>
            {{ form.inventoryFile }}<br><br>
            <p>OR copy-paste straight from B&G or the MKT Toolbox:</p>
            {{ form.inventoryText }}
        </fieldset>
        <br>
        {{ form.playerLevel.label }} {{ form.playerLevel(size=3, type="number", min="1", max="400") }} <br>
        {{ form.mode.label(for="mode-selection") }} {{ form.mode(id="mode-selection") }} <br>
        <div id="ranked-stuff">

        <br>
        <label>
            <input type="checkbox" id="selectAllWeeks"> Select All
        </label> <br>
        {{ form.weeks.label }} {{ form.weeks }}
        </div>
        <div id="acr-stuff">
        {{ form.tour.label(for="tour-selection") }} {{ form.tour(id="tour-selection") }}
        </div>
        <br>
        Level-up tickets:<br>
        {{ form.lnd(size=3, style="border-color:Silver;", type="number", min="0", max="999") }}
        {{ form.lnk(size=3, style="border-color:Silver;", type="number", min="0", max="999") }}
        {{ form.lng(size=3, style="border-color:Silver;", type="number", min="0", max="999") }}<br><br>
        {{ form.lsd(size=3, style="border-color:Goldenrod;", type="number", min="0", max="999") }}
        {{ form.lsk(size=3, style="border-color:Goldenrod;", type="number", min="0", max="999") }}
        {{ form.lsg(size=3, style="border-color:Goldenrod;", type="number", min="0", max="999") }}<br><br>
        {{ form.lhd(size=3, style="border-color:Fuchsia;", type="number", min="0", max="999") }}
        {{ form.lhk(size=3, style="border-color:Fuchsia;", type="number", min="0", max="999") }}
        {{ form.lhg(size=3, style="border-color:Fuchsia;", type="number", min="0", max="999") }}<br><br>
        Uncap tickets:<br>
        {{ form.und(size=3, style="border-color:Silver;", type="number", min="0", max="999") }}
        {{ form.unk(size=3, style="border-color:Silver;", type="number", min="0", max="999") }}
        {{ form.ung(size=3, style="border-color:Silver;", type="number", min="0", max="999") }}<br><br>
        {{ form.usd(size=3, style="border-color:Goldenrod;", type="number", min="0", max="999") }}
        {{ form.usk(size=3, style="border-color:Goldenrod;", type="number", min="0", max="999") }}
        {{ form.usg(size=3, style="border-color:Goldenrod;", type="number", min="0", max="999") }}<br><br>
        {{ form.uhd(size=3, style="border-color:Fuchsia;", type="number", min="0", max="999") }}
        {{ form.uhk(size=3, style="border-color:Fuchsia;", type="number", min="0", max="999") }}
        {{ form.uhg(size=3, style="border-color:Fuchsia;", type="number", min="0", max="999") }}<br><br>
            Battle course settings:<br>
    <div class="table-responsive" id="battle-table">
    <table>
        <tr>
            <td>Battle course #</td><td>1</td><td>2</td><td>3</td><td>4</td>
        </tr>
        <tr>
            <td>Aim for WF:</td><td>{{ form.wf1 }}</td><td>{{ form.wf2 }}</td><td>{{ form.wf3 }}</td><td>{{ form.wf4 }}</td>
        </tr>
    </table>
    </div>


    <div id="inventory-simulation">
    <h3>Simulate items in inventory</h3>
        If not in the inventory, selected items will be considered at level 1.
        <br>
        <label>
    <input type="checkbox" id="selectAll"> Select All
</label>
<br>
    <button class="collapsible-small-green" type="button">Spotlight Week 1+2</button>
    <div class="content">
        <label>
            <input type="checkbox" id="selectAllSpotlight"> Select All
        </label>
        <br>
        {{form.spotlight}}
    </div>
    <button class="collapsible-small-green" type="button">Daily Spotlight (Non-Gold)</button>
    <div class="content">
        <label>
            <input type="checkbox" id="selectAllDailyNonGold"> Select All
        </label>
        <br>
        {{form.dailySpotlightNonGold}}
    </div>
    <button class="collapsible-small-green" type="button">Daily Spotlight (Gold)</button>
    <div class="content">
        <label>
            <input type="checkbox" id="selectAllDailyGold"> Select All
        </label>
        <br>
        {{form.dailySpotlightGold}}
    </div>
    <button class="collapsible-small-green" type="button">Gold Pass</button>
    <div class="content">
        <label>
            <input type="checkbox" id="selectAllGoldPass"> Select All
        </label>
        <br>
        {{form.goldPass}}
    </div>
    <button class="collapsible-small-green" type="button">Paywalled (Commemorative, Gold Challenges)</button>
    <div class="content">
        <label>
            <input type="checkbox" id="selectAllPaywalled"> Select All
        </label>
        <br>
        {{form.paywalled}}
    </div>
    <button class="collapsible-small-green" type="button">Mii Shop</button>
    <div class="content">
        <label>
            <input type="checkbox" id="selectAllMiiShop"> Select All
        </label>
        <br>
        {{form.miiShop}}
    </div>
    <button class="collapsible-small-green" type="button">Other (Ranked, Challenge Cards, Token Shop, etc.)</button>
    <div class="content">
        <label>
            <input type="checkbox" id="selectAllOther"> Select All
        </label>
        <br>
        {{form.other}}
    </div>
        <br>
        <br>

</div>
        <input type="submit" class="btn btn-success" value="Run" />
         {% for field, errors in form.errors.items() %}
        <small class="form-text text-muted ">
        {{ ', '.join(errors) }}
        </small>
{% endfor %}
    </form>
<br><br>

<button class="btn btn-primary" data-toggle="modal" data-target="#myModal">Advanced Usage Tips</button>
<div class="modal fade" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title text-center">Advanced Usage Tips</h4>
      </div>
      <div class="modal-body">
          <ul>
            <li>You can use the 5th column to enter the partial level progress of an item.
                For example, for a driver at level 5 + 1/3 you should enter a 1.<br>
                The easiest way to get this data is to use the MKT Toolbox's sync+export functions.<br>
                If nothing is entered, the value is assumed to be 0.</li>
            <li> To limit the investments you're willing to make on an item, you can use the 6th
            and 7th columns for the level and uncaps, respectively. <br>
              For example, adding a 7 and a 3 in those columns will prevent the Optimizer from taking an item
              higher than 7/3.</li>
          </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<br><br>
    <h4>By aturtledude (Check out my <a href="https://coverageoptimizer.pythonanywhere.com">Coverage Optimizer</a>!)</h4>
    <h4>Thanks to DKR.exe for the action counts and formulas, and to Sam78it for the coverage data.</h4>
<script>
    function selectAllCheckboxes(listId, selectAllId) {
        var selectAllCheckbox = document.getElementById(selectAllId);
        var checkboxes = document.querySelectorAll('input[name="' + listId + '"]');
        var excludedCheckboxIds = ['wf1', 'wf2', 'wf3', 'wf4'];
        var checkboxesToCheck = Array.from(checkboxes).filter(function (checkbox) {
            return !excludedCheckboxIds.includes(checkbox.id);
        });

        selectAllCheckbox.addEventListener('change', function() {
            checkboxesToCheck.forEach(function(checkbox) {
                checkbox.checked = selectAllCheckbox.checked;
            });
        });

        checkboxesToCheck.forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                var allChecked = true;
                checkboxesToCheck.forEach(function(checkbox) {
                    if (!checkbox.checked) {
                        allChecked = false;
                    }
                });
                selectAllCheckbox.checked = allChecked;
            });
        });
    }

    document.addEventListener('DOMContentLoaded', function() {
        var lists = [
            { id: 'spotlight', selectAllId: 'selectAllSpotlight' },
            { id: 'dailySpotlightNonGold', selectAllId: 'selectAllDailyNonGold' },
            { id: 'dailySpotlightGold', selectAllId: 'selectAllDailyGold' },
            { id: 'goldPass', selectAllId: 'selectAllGoldPass' },
            { id: 'paywalled', selectAllId: 'selectAllPaywalled' },
            { id: 'miiShop', selectAllId: 'selectAllMiiShop' },
            { id: 'other', selectAllId: 'selectAllOther' },
            { id: 'weeks', selectAllId: 'selectAllWeeks'}
        ];

        lists.forEach(function(list) {
            selectAllCheckboxes(list.id, list.selectAllId);
        });

        // Select All checkboxes
        var selectAllCheckbox = document.getElementById('selectAll');
        var allCheckboxes = document.querySelectorAll('input[type="checkbox"]');
        selectAllCheckbox.addEventListener('change', function() {
            var excludedCheckboxIds = ['wf1', 'wf2', 'wf3', 'wf4'];
            allCheckboxes.forEach(function(checkbox) {
                if (!excludedCheckboxIds.includes(checkbox.id)) {
                    checkbox.checked = selectAllCheckbox.checked;
                }
            });
        });
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get references to the tour selection and inventory simulation section
        const modeSelection = document.getElementById('mode-selection');
        const tourSelection = document.getElementById('tour-selection');
        const inventorySimulation = document.getElementById('inventory-simulation');
        const rankedSelection = document.getElementById('ranked-stuff');
        const acrSelection = document.getElementById('acr-stuff');
        const battleTable = document.getElementById('battle-table')

        // Function to toggle the visibility and disabled state of the inventory simulation
        function toggleInventorySimulation() {
            if (modeSelection.value == 'acr' && tourSelection.value === 'current') {
                inventorySimulation.style.display = 'block';
            } else {
                inventorySimulation.style.display = 'none';
            }

            if (modeSelection.value == 'acr') {
                acrSelection.style.display = 'block';
                battleTable.style.display = 'block';
                rankedSelection.style.display = 'none';
            } else {
                acrSelection.style.display = 'none';
                battleTable.style.display = 'none';
                rankedSelection.style.display = 'block';
            }
        }

        // Initial call to set the initial state based on the default selection
        toggleInventorySimulation();

        // Add an event listener to the mode and tour selection fields
        modeSelection.addEventListener('change', toggleInventorySimulation);
        tourSelection.addEventListener('change', toggleInventorySimulation);
        battleTable.addEventListener('change', toggleInventorySimulation);
    });
</script>


{% endblock %}
